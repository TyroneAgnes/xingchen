(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[514],{7799:(e,s,t)=>{Promise.resolve().then(t.bind(t,996))},996:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>h});var a=t(5155),r=t(2115),i=t(6046),l=t(5565),n=t(2336),d=t(4085),c=t(5007),o=t(9134),u=t(4223),m=t(866),x=t(5346);function h(){let e=(0,i.useRouter)(),{toast:s}=(0,o.dj)(),[t,h]=(0,r.useState)(""),[f,p]=(0,r.useState)(null),[j,b]=(0,r.useState)(""),[v,g]=(0,r.useState)(!1),N=(0,x.Pj)(e=>e.submitRecharge),w=(0,x.Pj)(e=>e.getUserRechargeRecords()),y=async()=>{if(!t||!f){s({title:"提示",description:"请填写充值金额并上传支付凭证",variant:"destructive"});return}try{g(!0);let a=new FormData;a.append("file",f);let r=await fetch("/api/upload",{method:"POST",body:a}).then(e=>e.json());if(0!==r.code)throw Error(r.message);if(await N(parseFloat(t),r.data.url))s({title:"提交成功",description:"充值申请已提交,请等待审核"}),e.push("/wallet");else throw Error("提交失败")}catch(e){s({title:"提交失败",description:e instanceof Error?e.message:"未知错误",variant:"destructive"})}finally{g(!1)}};return(0,a.jsx)(m.A,{children:(0,a.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,a.jsx)(u.A,{title:"充值"}),(0,a.jsxs)("main",{className:"flex-1 container max-w-md mx-auto p-4",children:[(0,a.jsx)(c.Zp,{className:"p-4",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"充值金额"}),(0,a.jsx)(n.p,{type:"text",value:t,onChange:e=>{let s=e.target.value;/^\d*\.?\d*$/.test(s)&&h(s)},placeholder:"请输入充值金额"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"上传支付凭证"}),(0,a.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md",children:(0,a.jsxs)("div",{className:"space-y-1 text-center",children:[j?(0,a.jsx)(l.default,{src:j,alt:"Preview",width:200,height:200,className:"mx-auto"}):(0,a.jsxs)("div",{className:"text-gray-600",children:[(0,a.jsx)("p",{className:"text-xs",children:"点击或拖拽图片上传"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"支持 JPG、PNG 格式"})]}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(t){p(t);let e=new FileReader;e.onloadend=()=>{b(e.result)},e.readAsDataURL(t)}},className:"sr-only",id:"file-upload"}),(0,a.jsx)("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md font-medium text-primary hover:text-primary-dark focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary",children:(0,a.jsx)("span",{children:"选择图片"})})]})})]}),(0,a.jsx)(d.$,{className:"w-full",onClick:y,disabled:v,children:v?"提交中...":"提交充值申请"})]})}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4",children:"充值记录"}),(0,a.jsx)("div",{className:"space-y-4",children:w.map(e=>(0,a.jsxs)(c.Zp,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium",children:["充值金额: \xa5",e.amount]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.createTime).toLocaleString()})]}),(0,a.jsxs)("div",{children:["pending"===e.status&&(0,a.jsx)("span",{className:"text-yellow-500 text-sm",children:"审核中"}),"approved"===e.status&&(0,a.jsx)("span",{className:"text-green-500 text-sm",children:"已通过"}),"rejected"===e.status&&(0,a.jsx)("span",{className:"text-red-500 text-sm",children:"已拒绝"})]})]}),"rejected"===e.status&&e.rejectReason&&(0,a.jsxs)("p",{className:"text-xs text-red-500 mt-2",children:["拒绝原因: ",e.rejectReason]})]},e.id))})]})]})]})})}},2336:(e,s,t)=>{"use strict";t.d(s,{p:()=>l});var a=t(5155),r=t(2115),i=t(9602);let l=r.forwardRef((e,s)=>{let{className:t,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm bg-white/60 backdrop-blur-sm bg-blue-gray-100/15",t),ref:s,...l})});l.displayName="Input"},6046:(e,s,t)=>{"use strict";var a=t(6658);t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})}},e=>{var s=s=>e(e.s=s);e.O(0,[7525,59,5346,4557,8441,1517,7358],()=>s(7799)),_N_E=e.O()}]);